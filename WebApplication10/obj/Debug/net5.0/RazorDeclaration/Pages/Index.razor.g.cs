// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace WebApplication10.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 2 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using WebApplication10;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using WebApplication10.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Blazorise;

#line default
#line hidden
#nullable disable
#nullable restore
#line 12 "C:\Code\BlazorPrincessRedive\WebApplication10\_Imports.razor"
using Blazorise.Components;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Code\BlazorPrincessRedive\WebApplication10\Pages\Index.razor"
using Blazorise.DataGrid;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Code\BlazorPrincessRedive\WebApplication10\Pages\Index.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Code\BlazorPrincessRedive\WebApplication10\Pages\Index.razor"
using Newtonsoft.Json;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/")]
    public partial class Index : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 73 "C:\Code\BlazorPrincessRedive\WebApplication10\Pages\Index.razor"
 
    private Alert myAlert;
    private string url = "http://sd016808.asuscomm.com:6812";
    private List<ClanData> clanDatas = new List<ClanData>();
    private static readonly HttpClient client = new HttpClient();
    protected override async Task OnInitializedAsync()
    {
        var myObject = new
        {
            server = "1"
        };

        JsonContent content = JsonContent.Create(myObject);

        var response = await client.PostAsync(url + "/query/datetime", content);
        string responseString = await response.Content.ReadAsStringAsync();
        clanTime = JsonConvert.DeserializeObject<ClanTime>(responseString);

        var dates = clanTime.message.Keys.ToList();
        for (int i = 0; i < dates.Count(); i++)
        {
            var date = dates[i];
            dateList.Add(new MySelectModel() { MyTextField = date, MyValueField = i });
        }

        selectedDate = dateList.Count - 1;
    }

    public class MySelectModel
    {
        public int MyValueField { get; set; }
        public string MyTextField { get; set; }
    }

    static string[] Server = { "美食殿堂" };
    IEnumerable<MySelectModel> serverList = Enumerable.Range(1, Server.Length).Select(x => new MySelectModel { MyTextField = Server[x - 1], MyValueField = x });

    List<MySelectModel> dateList = new List<MySelectModel>();

    List<MySelectModel> timeList = new List<MySelectModel>();

    static string[] SearchFilter = { "戰隊名", "隊長名", "排名" };
    IEnumerable<MySelectModel> searchFilterList = Enumerable.Range(1, SearchFilter.Length).Select(x => new MySelectModel { MyTextField = SearchFilter[x - 1], MyValueField = x });

    private ClanTime clanTime = new ClanTime();

    int _selectedServer = 1;
    int selectedServer
    {
        get => _selectedServer;
        set
        {
            _selectedServer = value;
        }
    }

    int _selectDate = 1;
    int selectedDate
    {
        get => _selectDate;
        set
        {
            _selectDate = value;
            timeList.Clear();
            var times = clanTime.message[dateList[_selectDate].MyTextField];
            for (int i = 0; i < times.Count; i++)
            {
                var time = times[i];
                timeList.Add(new MySelectModel() { MyTextField = time, MyValueField = i });
            }

            selectedTime = timeList.Count - 1;
        }
    }

    int selectedTime { get; set; } = 1;

    int selectedFilter { get; set; } = 1;

    void OnSelectLatestBtnClicked()
    {
        selectedTime = timeList.Count - 1;
        selectedDate = dateList.Count - 1;
    }

    string GetTimeSetting()
    {
        return dateList[selectedDate].MyTextField + timeList[selectedTime].MyTextField;
    }

    async void OnSearchBtnClicked()
    {
        var temp = new List<ClanData>();
        var myObject = new
        {
            server = "1",
            date = GetTimeSetting()
        };

        JsonContent content = JsonContent.Create(myObject);

        var response = await client.PostAsync(url + "/query/clandata", content);
        string responseString = await response.Content.ReadAsStringAsync();
        Console.WriteLine(responseString);

        var datas = JsonConvert.DeserializeObject<ClanDatas>(responseString);
        foreach (var data in datas.Message)
        {
            temp.Add(new ClanData
            {
                Rank = data["Rank"],
                Clan_Name = data["Clan_Name"],
                Member = data["Member"],
                Lead_Name = data["Lead_Name"],
                Damage = data["Damage"],
                Lap = data["Lap"],
                Boss = data["Boss"],
                Left_Hp = data["Left_Hp"],
                Grade_Rank = data["Grade_Rank"]
            });
        }
        clanDatas = temp;
        StateHasChanged();
    }
    void OnSearchLineBtnClicked()
    {
        myAlert.Show();
    }

    public class ClanDatas
    {
        public List<Dictionary<string, string>> Message = new List<Dictionary<string, string>>();
    }

    public class ClanData
    {
        public string Rank { get; set; }
        public string Clan_Name { get; set; }
        public string Member { get; set; }
        public string Lead_Name { get; set; }
        public string Damage { get; set; }
        public string Lap { get; set; }
        public string Boss { get; set; }
        public string Left_Hp { get; set; }
        public string Grade_Rank { get; set; }
    }

    public class ClanTime
    {
        public Dictionary<string, List<string>> message = new Dictionary<string, List<string>>();
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime JSRuntime { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient Http { get; set; }
    }
}
#pragma warning restore 1591
